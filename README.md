# README

## Introduction

This program is meant to be run on the command-line to generate a [SimpleArchiveFormat](https://wiki.duraspace.org/display/DSDOC6x/Importing+and+Exporting+Items+via+Simple+Archive+Format) (SAF) directory for exporting batches of items into a DSpace repository. It will takea  directory of objects where each object is a directory that contains a PDF file and some metadata record describing the object and convert the requested objects into a SAF for ingest into a DSpace repository.

## Constraints

- Requires input metadata be in XML format
- Requires each object to be a contained directory with the main file and the descriptive metadata file
- Requires the main file to be a PDF

## Quick start instructions

1. clone this repository
1. create a virtualenv on your system
1. activate the new virtualenv
1. cd into the cloned repo directory
1. run pip install -r requirements.txt
1. run python setup.py install
1. make sure that the objects that you want to create SAF for are in a location that your user account is permitted to access

## Available command-line scripts

1. ```find_mamluk_files``` will find the Mamluk Journal data fitting the defined filter value
1. ```find_dissertations``` will find the Proquest exported dissertation data for the dissertations in the spreadsheet inputted
1. ```index_dissertations``` will find ProQuest exported dissertations that are no in the index file pointed to
1. ```generate_safs``` which will generate a SimpleArchiveFormat directory where each item has some binary document file plus metadata required to be displayed in Knowledge@UChicago
1. ```modify_doi_locations``` will take a list of DOIs and modify the URL that those DOIs direct to
1. ```create_safs_of_only_metadata```will generate a SimpleArchiveFormat directory containing items that have only dublin_core.xml files

## Instructions for writing extraction configuration

An extraction configuration file is the instructions for how the saf generation CLI should locate the different metadata needed for the dublin_core.xml file for each item in a SimpleArchiveFormat directory.

The extraction configuration tells the saf generation CLI command how to find the metadata values needed to describe the object.

There are three categories of extraction configuration instructions

- singles is an extraction which derives the metadata value from a simple element in the original metadata
- multiples is an  extraction instruction which drives its metadata from a complex element in the original metadata. It needs the immediate parent element from which the metadata value should be derived and the simple elements inside that parent from which values can be found. It also must have a display_order instruction for how the value of the simple elements should be put down and the type of data (list or string) that the value extracted should be interpreted by the safgeneration tool.
- hardcoded is a value that you are defining explicitly in the extraction instruction

A particular extraction instruction might look like

```application/json
{
    "singles": {
        "title": {"base": "DISS_description/DISS_title"}
    },
    "multiples": {
        "author": {"base": "DISS_authorship/DISS_author[@type='primary']/DISS_name",
                   "tail": {"query": ["DISS_fname", "DISS_middle", "DISS_surname"],
                            "display_order": ["DISS_surname", "DISS_fname", "DISS_middle"],
                            "val_type": "string"
                           }
                  }
    },
    "hardcoded": {
        "publisher`": "University of Chicago"
    }
}
```

This will do the following:

- Extract the title value from the XPath exploration from root element to "DISS_description/DISS_title"
- Extract the author value by first finding the XPATH element to DISS\_authorship/DISS\_author[@type='primary']/DISS\_name then finding the simple elements inside that complex element DISS\_fname, DISS\_middle, and DISS\_surname then finally returning a string value such that the value of DISS\_surname is first followed by the value of DISS\_fname followed by DISS\_middle
- Create a metadata field called publisher with the value "University of Chicago"

## Instructions for writing crosswalk configuration

A crosswalk configuration is the instructions for how the saf generation should map the extracted metadata to DSpace Dublin Core records.

The crosswalk file is a JSON record with a key:value for each metadata field generated by metadata extraction. The key name is the field name, and the value is a key:value pair with the follow key:values

    - element with a value of the DC element name that the extraction metadata  should be put into
    - qualifier with a value of the DC qualifier name that is necessary. if no qualifier is applicable, enter 'none'

A particular crosswalk definition might look like

```application/json
{
    "title": {"element": "title", "qualifier":"none"},
    "author": {"element": "contributor", "qualifier":"author"},
    "publisher":{"element":"publisher", "qualifier":"none"}
}
```

This example will create a dublin_core xml that looks like the following

```application/xml
<dublin_core>
    <dcvalue element="title" qualifier="none"/>
    <dcvalue element="contributor" qualifier="author"/>
    <dcvalue element="publisher" qualifer="none">University of Chicago</dcvalue>
</dublin_core>
```
